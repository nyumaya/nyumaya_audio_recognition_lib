language: cpp


matrix:
  include:
    - os: linux
      dist: xenial

#    - os: linux
#      dist: trusty

#    - os: linux
#      dist: bionic

    - os: osx
      osx_image: xcode10.1

#    - os: osx
#      osx_image: xcode9.4

  allow_failures:
    - os: windows


before_script:
    - git clone https://github.com/tensorflow/tensorflow.git 
    - cd tensorflow
    - git checkout 51c7df0cfc45d31c2ce2cd61e5c66969d890de2a 

script: 
    - git clone https://github.com/nyumaya/nyumaya_audio_recognition_lib.git
    - cd nyumaya_audio_recognition_lib/
    - git apply --unsafe-paths --directory=../ tflite.patch
    - ../tensorflow/lite/tools/make/download_dependencies.sh
    - bash make_all.sh
#    - cmake ./
#    - make 
#    - ./test
    
deploy:
    provider: releases
    api_key: $GITHUB_TOKEN
    file_glob: true
    file: build/release/*/libnyumaya*
    skip_cleanup: true
    draft: true
    on:
        tags: true

